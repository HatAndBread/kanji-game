<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('header')%>
  </head>
  <body>
    <ul>
      <% for (let i = 0; i < sets.length; i++){ %>
      <div class="set-card">
        <li class="set-title">
          <button type="button" class="main-button set-edit-butt" value="<%=sets[i].title%>">
            <%= sets[i].title%>
          </button>
        </li>
      </div>
      <% } %>
    </ul>
    <label for="select-set-for-edit"></label>
    <select name="select-set-for-edit" id="select-set-for-edit"></select>
    <div id="set-editor">
      <h1 id="set-title"></h1>
      <ul id="edit-word-list"></ul>
      <table id="edit-table">
        <tr>
          <th>かんじ</th>
          <th>よみかた</th>
        </tr>
      </table>
      <button id="add-word-butt" class="main-button" type="button">Add another word</button>
      <button id="save-changes-butt" class="main-button" type="submit">Save changes</button>
    </div>
  </body>

  <script>
    const setEditButts = document.getElementsByClassName('main-button set-edit-butt');
    const setEditor = document.getElementById('set-editor');
    const setTitle = document.getElementById('set-title');
    const table = document.getElementById('edit-table');
    const addWordButt = document.getElementById('add-word-butt');
    addWordButt.addEventListener('click', () => {
      const newRow = document.createElement('tr');
      const newWord = document.createElement('td');
      const newDef = document.createElement('td');
      const kanjiInput = document.createElement('input');
      const yomikataInput = document.createElement('input');
      kanjiInput.type = 'text';
      yomikataInput.type = 'text';
      kanjiInput.name = 'kanji-input';
      yomikataInput.name = 'yomikata-input';
      kanjiInput.id = 'kanji-input';
      yomikataInput.id = 'yomikata-input';
      kanjiInput.required = true;
      yomikataInput.required = true;
      newWord.appendChild(kanjiInput);
      newDef.appendChild(yomikataInput);
      newRow.appendChild(newWord);
      newRow.appendChild(newDef);
      table.appendChild(newRow);
    });

    const getWords = async (setName) => {
      const res = await fetch(`/edit-sets/${setName}`);
      const data = await res.json();
      const title = data.requestedSet.title;
      const wordList = data.requestedSet.words;
      setTitle.appendChild(document.createTextNode(title));
      for (let i = 0; i < wordList.length; i++) {
        let newRow = document.createElement('TR');
        let kanjiDataTable = document.createElement('TD');
        let yomikataDataTable = document.createElement('TD');
        let kanjiInput = document.createElement('input');
        let yomikataInput = document.createElement('input');

        kanjiInput.type = 'text';
        yomikataInput.type = 'text';
        kanjiInput.name = 'kanji-input';
        yomikataInput.name = 'yomikata-input';
        kanjiInput.value = wordList[i].kanji;
        yomikataInput.value = wordList[i].yomikata;

        kanjiDataTable.appendChild(kanjiInput);
        yomikataDataTable.appendChild(yomikataInput);
        newRow.appendChild(kanjiDataTable);
        newRow.appendChild(yomikataDataTable);
        table.appendChild(newRow);
      }
    };
    for (let i = 0; i < setEditButts.length; i++) {
      setEditButts[i].addEventListener('click', (e) => {
        getWords(e.target.value);
      });
    }
  </script>
</html>
